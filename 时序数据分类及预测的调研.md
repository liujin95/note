# 时序数据分类及预测的调研

## 分类

1. 传统方法（需要手工设计）：

   * **DTW（dynamic time warping) & KNN**

     在深度学习大量使用之前，在时间序列分类方面，DTW和KNN的结合是一种很有用的方法。

     在做两个不同的时间序列匹配的时候，虽然我们可以通过肉眼发现它们之间存在着很高的相似性，但是由于部分位置的拉伸或者压缩，或者沿着时间轴上存在着平移，对两者直接计算欧氏距离效果一般不是很好，而定义规则进行对齐又无法适用实际应用中的多种情况。

     DTW是在1970年提出了，其思想在一定程度上解决了该问题，通过动态规划的方法，来计算损失（即距离），最小的作为输出结果。

     ![image-20210228153849085](C:\Users\智萍\AppData\Roaming\Typora\typora-user-images\image-20210228153849085.png)

     如上图两个时序信号虽然相似，但还是存在差异性。DTW可以计算这两个序列的相似程度，并给出一个能最大程度降低两个序列距离的点到点的匹配。

     >举一个例子：给定一个样本序列X和比对序列Y,Z：
     >
     >X：3，5，6，7，7，1
     >Y：3，6，6，7，8，1，1
     >Z：2，5，7，7，7，7，2
     >
     >请问Y、Z哪一个跟X更相似？
     >
     >DTW首先会根据序列点之间的距离(欧氏距离)，获得一个序列距离矩阵 MM，其中行对应X序列，列对应Y序列，矩阵元素为对应行列中X序列和Y序列点到点的欧氏距离。
     >
     >通过这个方法，可以通过动态规划来获得一个更为合理的度量结果，用该结果来表示两个样本之间的相似性关系，其动态搜索的过程也可以表示为下图。
     >
     >![image-20210228154930374](C:\Users\智萍\AppData\Roaming\Typora\typora-user-images\image-20210228154930374.png)

     而DTW和KNN之间的结合可以表示为下图所示，用DTW来获得一种度量结果，然后通过KNN进行聚类。

     ![image-20210228155005079](C:\Users\智萍\AppData\Roaming\Typora\typora-user-images\image-20210228155005079.png)

   * **基于特征的方法**

     这一类的方法都是一些通过某种度量关系来提取相关特征的方法，如词袋法，通过找到该时间序列中是否有符合已有词袋中的特征（序列的样子），将一个序列用词来表示，再对词进行分类。而其他的基于特征的方法都是利用了类似的方法，如提取统计量，基于规则等，再通过分类模型进行分类。

2. 深度学习

   * MLP、FCN、ResNet

     >基于深度学习的方法在实际上的处理和处理二维数据的方法上基本相同，由于时序信息每一个样本都可以看作为一个数组。而MLP的输入正好是一个向量（数组），通过全连接的形式对整体数组的每一个元素逐层赋予权重，并求得最后的分类，这种方法是一种比较粗暴的学习方法，直接学习所有元素直接的线性或非线性相关关系，但是并没有去深度挖掘数组中更好的表现特征，分类效果不佳。

     >FCN是将MLP中的全链接层用卷积层进行替代，ResNet也是，但是其中的卷积层都用一维卷积核进行了替代。

     ![image-20210228155536871](C:\Users\智萍\AppData\Roaming\Typora\typora-user-images\image-20210228155536871.png)

     通过实验，发现深度学习的方法效果基本上与传统方法相接近，甚至有所超过，其中整体表现最好的是FCN。

   * **LSTM_FCN、BIGRU_CNN**

     LSTM_FCN的方法比较简单，是将输入分别输入到两个分支中，LSTM和FCN，并在最后将两个输出分支进行concat进行softmax获得分类结果。实验者说这种方法取得了比FCN更好的效果。

     ![image-20210228160621420](C:\Users\智萍\AppData\Roaming\Typora\typora-user-images\image-20210228160621420.png)

      BiGRU-CNN与以上方法相比相似，只是将LSTM分支替换成双向的GRU分支。

   * **MC_CNN(multi-channel CNN)、MCNN(multi-scale CNN)**

     ![image-20210228160653811](C:\Users\智萍\AppData\Roaming\Typora\typora-user-images\image-20210228160653811.png)

     MC-CNN应用于NLP中，与之前的方法不同的是，这种方法比较重要的一步是初始化不同的embedding，对数据进行编码，形成多个通道的输入，再通过卷积层学习，最后进行分类。
     MCNN是将图像处理中的多尺度的思想融入了时间序列处理中，将不同的feature map输出出来，进行预测分类，可以参考FPN这种结构。

## 预测

时间序列预测工具方法可以归结为三大类：

* 基于业务场景理解的因子预测模型

  基于因子的时序预测是一种传统的预测手法，在一些特定场景有着比较好的表现，比如某条业务线刚起步，历史数据的积累有限的时候。同时该方法基于其业务解释性强、准确率也比较高的特点，可以作为时序预测项目的baseline，并且在黑盒模型做输出时，可以帮助进行后置校准，避免输出较大的偏差。

* 传统时间序列预测模型，比如均值回归、ARIMA、指数平滑预测法（比如Holt-Winters)等

  传统时间序列预测模型，通常指用于时间序列分析/预测的统计学模型，比如常用的有均值回归、ARIMA、指数平滑预测法等。其中均值回归，指对历史一段时间的值取平均，作为未来每个时刻的预测。其他时间序列预测模型比如ARIMA（auto-regressive integrated moving average）、一些指数平滑模型（SEM，Holt-Winters等），主要通过对历史数据的建模分析，抽离出其中的趋势，最后通过对趋势的预测得到未来一段时间需求的变化。


* 机器学习模型，比如支持向量机、树模型（比如GBM、QRF）、神经网络模型（比如RNN、CNN）等

  在运用机器学习模型时，我们可以把时间序列模型当成一个回归问题来解决，常见的方法有树模型与神经网络模型两大类。

  *树模型*

  >一般采用的是xgboost或者lightgbm的方法，现在业界也被广泛应用.树模型可以方便地添加一些category类的特征比如：是否季节末、是否公共价格、是否营业时间等。

  *神经网络模型*

  >常见的利用神经网络技术来做时间序列预测的方法有有CNN、RNN、LSTM、GRU等。
  >
  >相对于传统的树模型需要人工构建相关模型特征，神经网络模型通常需要喂入大量的数据来进行训练，因此如果同类时序的数据量够多（有够多彼此间相关性较强的时序），那么训练一个通用型的端对端的神经网络预测有时也有不错的效果，比如使用LSTM一方面可以较容易地整合外部变量，另一方面LSTM有能较好地自动提取时序特征的能力。

  











